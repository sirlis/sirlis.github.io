<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="zh-CN" 
  
>
  <!-- The Head -->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  >

  

  

  
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="强化学习（策略梯度法）" />
<meta property="og:locale" content="zh_CN" />
<meta name="description" content="本文介绍了强化学习的策略梯度法（Policy Gradient）。" />
<meta property="og:description" content="本文介绍了强化学习的策略梯度法（Policy Gradient）。" />
<link rel="canonical" href="http://localhost:4000/posts/reinforcement-learning-Policy-Gradient/" />
<meta property="og:url" content="http://localhost:4000/posts/reinforcement-learning-Policy-Gradient/" />
<meta property="og:site_name" content="SIRLIS" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-11-27T16:43:19+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="强化学习（策略梯度法）" />
<meta name="twitter:site" content="@none" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-04-18T18:59:14+08:00","datePublished":"2023-11-27T16:43:19+08:00","description":"本文介绍了强化学习的策略梯度法（Policy Gradient）。","headline":"强化学习（策略梯度法）","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/reinforcement-learning-Policy-Gradient/"},"url":"http://localhost:4000/posts/reinforcement-learning-Policy-Gradient/"}</script>
<!-- End Jekyll SEO tag -->

  

  <title>强化学习（策略梯度法） | SIRLIS
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="SIRLIS">
<meta name="application-name" content="SIRLIS">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin>
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
    

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">
  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">

  <link rel="stylesheet" href="/assets/css/style.css">

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.21.0/dist/tocbot.min.css">
  

  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css">
  

  <!-- JavaScript -->

  
    <!-- Switch the mode between dark and light. -->

<script type="text/javascript">
  class ModeToggle {
    static get MODE_KEY() {
      return 'mode';
    }
    static get MODE_ATTR() {
      return 'data-mode';
    }
    static get DARK_MODE() {
      return 'dark';
    }
    static get LIGHT_MODE() {
      return 'light';
    }
    static get ID() {
      return 'mode-toggle';
    }

    constructor() {
      if (this.hasMode) {
        if (this.isDarkMode) {
          if (!this.isSysDarkPrefer) {
            this.setDark();
          }
        } else {
          if (this.isSysDarkPrefer) {
            this.setLight();
          }
        }
      }

      let self = this;

      /* always follow the system prefers */
      this.sysDarkPrefers.addEventListener('change', () => {
        if (self.hasMode) {
          if (self.isDarkMode) {
            if (!self.isSysDarkPrefer) {
              self.setDark();
            }
          } else {
            if (self.isSysDarkPrefer) {
              self.setLight();
            }
          }

          self.clearMode();
        }

        self.notify();
      });
    } /* constructor() */

    get sysDarkPrefers() {
      return window.matchMedia('(prefers-color-scheme: dark)');
    }

    get isSysDarkPrefer() {
      return this.sysDarkPrefers.matches;
    }

    get isDarkMode() {
      return this.mode === ModeToggle.DARK_MODE;
    }

    get isLightMode() {
      return this.mode === ModeToggle.LIGHT_MODE;
    }

    get hasMode() {
      return this.mode != null;
    }

    get mode() {
      return sessionStorage.getItem(ModeToggle.MODE_KEY);
    }

    /* get the current mode on screen */
    get modeStatus() {
      if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) {
        return ModeToggle.DARK_MODE;
      } else {
        return ModeToggle.LIGHT_MODE;
      }
    }

    setDark() {
      document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
    }

    setLight() {
      document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
    }

    clearMode() {
      document.documentElement.removeAttribute(ModeToggle.MODE_ATTR);
      sessionStorage.removeItem(ModeToggle.MODE_KEY);
    }

    /* Notify another plugins that the theme mode has changed */
    notify() {
      window.postMessage(
        {
          direction: ModeToggle.ID,
          message: this.modeStatus
        },
        '*'
      );
    }

    flipMode() {
      if (this.hasMode) {
        if (this.isSysDarkPrefer) {
          if (this.isLightMode) {
            this.clearMode();
          } else {
            this.setLight();
          }
        } else {
          if (this.isDarkMode) {
            this.clearMode();
          } else {
            this.setDark();
          }
        }
      } else {
        if (this.isSysDarkPrefer) {
          this.setLight();
        } else {
          this.setDark();
        }
      }

      this.notify();
    } /* flipMode() */
  } /* ModeToggle */

  const modeToggle = new ModeToggle();
</script>

  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!-- The Side Bar -->

<div id="sidebar" class="d-flex flex-column align-items-end">
  <div class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle">
      
        
        <img src="/assets/img/head.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'">
      
    </a>

    <div class="site-title">
      <a href="/">SIRLIS</a>
    </div>
    <div class="site-subtitle fst-italic">分享科研和生活的日常</div>
  </div>
  <!-- .profile-wrapper -->

  <ul class="nav flex-column flex-grow-1 w-100 ps-0">
    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home"></i>
        <span>首页</span>
      </a>
    </li>
    <!-- the real tabs -->
    
      <li class="nav-item">
        <a href="/categories/" class="nav-link">
          <i class="fa-fw fas fa-stream"></i>
          

          <span>分类</span>
        </a>
      </li>
      <!-- .nav-item -->
    
      <li class="nav-item">
        <a href="/tags/" class="nav-link">
          <i class="fa-fw fas fa-tags"></i>
          

          <span>标签</span>
        </a>
      </li>
      <!-- .nav-item -->
    
      <li class="nav-item">
        <a href="/archives/" class="nav-link">
          <i class="fa-fw fas fa-archive"></i>
          

          <span>归档</span>
        </a>
      </li>
      <!-- .nav-item -->
    
      <li class="nav-item">
        <a href="/about/" class="nav-link">
          <i class="fa-fw fas fa-info-circle"></i>
          

          <span>关于</span>
        </a>
      </li>
      <!-- .nav-item -->
    
  </ul>
  <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    
      <button class="mode-toggle btn" aria-label="Switch Mode">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    
      

      
        <a
          href="https://github.com/sirlis"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github"></i>
        </a>
      
    
      

      
        <a
          href="https://twitter.com/none"
          aria-label="twitter"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-twitter"></i>
        </a>
      
    
      

      
        <a
          href="javascript:location.href = 'mailto:' + ['lihongjue','buaa.edu.cn'].join('@')"
          aria-label="email"
          

          

          

          
        >
          <i class="fas fa-envelope"></i>
        </a>
      
    
      

      
        <a
          href="/feed.xml"
          aria-label="rss"
          

          

          

          
        >
          <i class="fas fa-rss"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</div>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div id="main" class="container px-xxl-5">
        <!-- The Top Bar -->

<div id="topbar-wrapper">
  <div
    id="topbar"
    class="container d-flex align-items-center justify-content-between h-100"
  >
    <span id="breadcrumb">
      

      
        
          
            <span>
              <a href="/">
                首页
              </a>
            </span>

          
        
          
        
          
            
              <span>强化学习（策略梯度法）</span>
            

          
        
      
    </span>
    <!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      文章
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="搜索..."
      >
    </span>
    <span id="search-cancel">取消</span>
  </div>
</div>

        











<div class="row">
  <!-- core -->
  <div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pe-xl-4">
    

    <div class="post px-1 px-md-2">
      

      
        
      
        <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->


<!-- images -->



  
  

  <!-- CDN URL -->
  

  <!-- Add image path -->
  

  
    
      
      
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        
      
    

    <!-- combine -->
    

  

  



<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    

    

  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    

    

  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    

    

  

  
  

  




<!-- return -->




<h1 data-toc-skip>强化学习（策略梯度法）</h1>

<div class="post-meta text-muted">
    <!-- published date -->
    <span>
      发表于
      <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em
  class=""
  data-ts="1701074599"
  data-df="YYYY/MM/DD"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  2023/11/27
</em>

    </span>

    <!-- lastmod date -->
    
    <span>
      更新于
      <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em
  class=""
  data-ts="1744973954"
  data-df="YYYY/MM/DD"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  2025/04/18
</em>

    </span>
    

  

  <div class="d-flex justify-content-between">
    <!-- author(s) -->
    <span>
      

      作者

      <em>
      
        <a href="https://github.com/sirlis">sirlis</a>
      
      </em>
    </span>

    <div>
      <!-- read time -->
      <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="8920 字"
>
  <em>49 分钟</em>阅读</span>

    </div>

  </div> <!-- .d-flex -->

</div> <!-- .post-meta -->

<div class="post-content">
  <p>本文介绍了强化学习的策略梯度法（Policy Gradient）。</p>

<!--more-->

<hr />

<ul>
  <li><a href="#1-回顾基于价值的强化学习">1. 回顾基于价值的强化学习</a></li>
  <li><a href="#2-策略梯度">2. 策略梯度</a>
    <ul>
      <li><a href="#21-策略函数">2.1. 策略函数</a></li>
      <li><a href="#22-策略函数的分布形式">2.2. 策略函数的分布形式</a></li>
      <li><a href="#23-策略梯度">2.3. 策略梯度</a>
        <ul>
          <li><a href="#231-回顾价值梯度">2.3.1. 回顾价值梯度</a></li>
          <li><a href="#232-策略梯度">2.3.2. 策略梯度</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#3-策略梯度的计算">3. 策略梯度的计算</a>
    <ul>
      <li><a href="#31-基于累计奖励的策略梯度">3.1. 基于累计奖励的策略梯度</a></li>
      <li><a href="#32-基于初始状态价值的策略梯度">3.2. 基于初始状态价值的策略梯度</a></li>
      <li><a href="#33-策略梯度定理">3.3. 策略梯度定理</a></li>
    </ul>
  </li>
  <li><a href="#4-基于策略梯度的参数更新">4. 基于策略梯度的参数更新</a>
    <ul>
      <li><a href="#41-reinforce">4.1. REINFORCE</a></li>
      <li><a href="#42-reinforce-with-baseline">4.2. REINFORCE with baseline</a></li>
      <li><a href="#43-actor-critic-related-to-v">4.3. Actor-Critic (related to V)</a></li>
      <li><a href="#44-actor-critic-related-to-q">4.4. Actor-Critic (related to Q)</a></li>
      <li><a href="#45-advantage-actor-critic-a2c">4.5. Advantage Actor-Critic (A2C)</a>
        <ul>
          <li><a href="#451-探索与利用">4.5.1. 探索与利用</a></li>
          <li><a href="#452-与-vac-的关系">4.5.2. 与 VAC 的关系</a></li>
        </ul>
      </li>
      <li><a href="#46-重要性采样">4.6. 重要性采样</a>
        <ul>
          <li><a href="#461-重要性用于期望估计">4.6.1. 重要性用于期望估计</a></li>
          <li><a href="#462-重要性用于策略梯度">4.6.2. 重要性用于策略梯度</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#5-确定性策略梯度dpg">5. 确定性策略梯度（DPG）</a></li>
  <li><a href="#6-参考文献">6. 参考文献</a></li>
</ul>

<h2 id="1-回顾基于价值的强化学习"><span class="me-2">1. 回顾基于价值的强化学习</span><a href="#1-回顾基于价值的强化学习" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>基于价值函数的强化学习方法</p>

<ul>
  <li>动态规划方法（Dynamic Programming, DP）</li>
  <li>蒙特卡洛方法（Monte Carlo, MC）</li>
  <li>时序差分方法（Temporal-Difference, TD）</li>
</ul>

<p>这三种方法存在共同特点：</p>

<ul>
  <li>在求解强化学习任务时，最终目标是求解满足规则的最优策略 $\pi$。但以上三种方法并 <strong>没有直接求解</strong> 策略 $\pi$ 这个变量，而是先计算状态价值函数 $v_\pi(s)$ 或状态-动作价值函数 $q_\pi(s,a)$；然后再基于价值函数结果改进策略 $\pi$，是一种间接方式;</li>
  <li>在策略改进过程中，本质上均选择<strong>最优价值函数</strong>对应的动作作为新的策略；</li>
  <li>均为<strong>表格式</strong>强化学习的代表方法。</li>
</ul>

<p>特别地，对于 DQN 方法，神经网络的输入是原始的状态信息，如游戏画面，输出是在这种状态下执行各种动作的回报，即价值函数（Q函数）。训练完成之后，神经网络逼近的是最优 $q(s,a)$。</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>          +----+ ----&gt; Q(s,a1)                       +----+
  s  ---&gt; |f(x)| ----&gt; Q(s,a2)       or     s,ai ---&gt;|f(x)| ----&gt; Q(s,ai)
          +----+ ----&gt; Q(s,a3)                       +----+
</pre></td></tr></tbody></table></code></div></div>

<p>以 DQN 为代表的值函数近似方法，虽然在某些问题上取得了成功，但存在以下问题：</p>

<ul>
  <li>
    <p><strong>无法表示随机策略</strong>。某些问题的最优策略是随机策略，需要以不同的概率选择不同的动作。而基于价值的强化学习算法在实现时采用了贪心策略，给定一个状态 ，选择的策略是确定性的，显然无法实现这种按照概率执行各种候选动作的要求。比如石头剪刀布的最优策略是以 (1/3, 1/3, 1/3）的概率来选择石头/剪刀/布，基于价值的强化学习无法实现这种策略。</p>
  </li>
  <li>
    <p><strong>无法处理高维动作空间</strong>。DQN 要求动作空间是离散的，且只能是有限个，这样才能寻找使动作值函数最大化的动作的操作。但在很多问题特别是物理控制任务中，具有连续实值和高维的动作空间，例如要控制在 x y z 方向的速度、加速度。DQN 不能直接应用。</p>
  </li>
  <li>
    <p><strong>难以收敛</strong>。基于价值的强化学习方法输出的价值（如各个动作的最优 <code class="language-plaintext highlighter-rouge">Q</code> 函数值）的微小改变会导致某一动作被选中或不选中，这种不连续的变化会影响算法的收敛。这很容易理解，假设一个动作<code class="language-plaintext highlighter-rouge">a</code>的<code class="language-plaintext highlighter-rouge">Q</code>函数值本来在所有动作中是第 2 大的，把它增加 0.0001，就变成最大的，那这种微小的变化会导致策略完全改变。因为之前它不是最优动作，现在变成最优动作了。</p>
  </li>
  <li>
    <p><strong>存在徘徊</strong>。在观察受限的情况下，基于价值的强化学习方法会出现徘徊现象。即出现不同状态导致的观察相同，使得对应相同的 “最佳” 策略，但明显不符合任务实际情况的现象。</p>
  </li>
</ul>

<p>本质上，以 DQN 为代表的值函数近似方法，已经能够较好地将价值函数通过神经网络进行逼近，但最终进行策略选取时，还是只能适用于表格形式的离散策略。我们是否能够借鉴值函数近似方法，采用函数来直接近似策略呢？</p>

<h2 id="2-策略梯度"><span class="me-2">2. 策略梯度</span><a href="#2-策略梯度" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="21-策略函数"><span class="me-2">2.1. 策略函数</span><a href="#21-策略函数" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>直接借鉴值函数近似的方法，使用神经网络作为策略函数，输出某个状态 $s$ 下执行各种动作的概率值，即将策略参数化为</p>

\[\pi(a\vert s) = p(a \vert s;\theta)\]

<p>这种做法的原理如下图所示</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>          +----+ ----&gt; p(a1|s;θ)
  s  ---&gt; |f(x)| ----&gt; p(a2|s;θ)
          |  θ | ----&gt; ...
          +----+ ----&gt; p(a3|s;θ)
</pre></td></tr></tbody></table></code></div></div>

<p>此时，动作 $a$ 服从某一概率密度函数 $p(a\vert s;\theta)$ ，也即将动作 $a$ 理解成从概率模型 $p(a\vert s;\theta)$ 产生的样本。我们的目标也就从直接求解 $p(a\vert s;\theta)$ 转换成求解参数 $\theta$。</p>

<p>将含参数 $\theta$ 的策略称为<strong>策略函数</strong>，记作 $\pi(a \vert s;\theta)$，通常情况下可简写成 $\pi_{\theta}$。</p>

<h3 id="22-策略函数的分布形式"><span class="me-2">2.2. 策略函数的分布形式</span><a href="#22-策略函数的分布形式" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>前面假设动作 $a$ 服从某一概率密度函数 $p(a\vert s;\theta)$，这里对其概率密度函数形式进行一些额外的讨论。</p>

<ul>
  <li>
    <p>如果动作 $a$ 是<strong>离散随机变量</strong>，使用 $\text{softmax}$ 函数将其映射为 <strong>指数族分布</strong></p>

    <p>这里并不是一定要使用 $\text{softmax}$ 函数进行映射，而是只要能够映射为 “指数族分布” 即可。定义 $h(s,a;\theta)$ 函数为 “动作偏好值”，将离散型的策略 $\pi(a \vert s;\theta)$ 视为关于 $\theta$ 的一个函数，有</p>

\[\pi(a \vert s;\theta) \rightarrow \frac{e^{h(s,a;\theta)}}{\sum_{a'}e^{h(s,a';\theta)}}\]
  </li>
  <li>
    <p>如果动作 $a$ 是<strong>连续随机变量</strong>，服从的分布可以有很多种，不妨认为服从 <strong>高斯分布</strong></p>

    <p>这里将高斯分布中的 $\mu,\sigma$ 看作参数 $\theta$ 的函数，若 $\theta$ 能够求解， $\mu,\sigma$ 同样也可以被求解，最终求解整个分布</p>

\[\mu=\mu(s;\theta),\sigma=\sigma(s;\theta)\]

    <p>若 $a$ 是服从 1 维随机变量的高斯分布，策略函数 $\pi(a \vert s;\theta)$ 表示如下</p>

\[\pi(a \vert s;\theta) = \frac{1}{\sqrt{2\pi}\sigma}e^{-\frac{(a-\mu)^2}{2\sigma^2}}\]
  </li>
</ul>

<p>为了改进策略函数，需要围绕参数 $\theta$ 构建一个目标函数 $J(\theta)$，然后通过梯度下降（上升）的方式更新参数。</p>

<blockquote>
  <p>在后面我们会发现，最终需要计算目标函数的梯度，相当于计算策略函数的对数的梯度，但通常我们不会直接使用策略函数的对数的梯度，因为可以采用成熟的深度学习框架（PyTorch或者TensorFlow）自动求导来完成。</p>
</blockquote>

<h3 id="23-策略梯度"><span class="me-2">2.3. 策略梯度</span><a href="#23-策略梯度" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>确定策略函数后，下一步就是建立策略梯度的概念。我们首先从价值函数的梯度出发，引出策略梯度的定义。</p>

<h4 id="231-回顾价值梯度"><span class="me-2">2.3.1. 回顾价值梯度</span><a href="#231-回顾价值梯度" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>首先回顾 Q-Learning 的核心思想，通过一步采样更新 Q 值</p>

\[q(s_t,a_t)\leftarrow q(s_t,a_t)+\alpha[r_{t+1}+\gamma\max_a q(s_{t+1},a)−q(s_t,a_t)]\]

<p>上述更新过程<strong>可以收敛</strong>，意味着 TD-Error 最终收敛至零</p>

\[r_{t+1}+\gamma\max_a q(s_{t+1},a)−q(s_t,a_t) \rightarrow 0\]

<p>那么我们可以构造一个参数为 $\theta$ 的深度神经网络，用来估计价值函数，即 DQN 方法</p>

\[q(s,a) = q(s,a; \theta)\]

<p>则训练用的损失函数可设计为</p>

\[L(\theta) = \mathbb{E} \{[r_{t+1}+\gamma\max_a q(s_{t+1},a; \theta)−q(s_t,a_t; \theta)]^2\}\]

<p>然后，通过梯度下降更新神经网络的参数，使得损失函数 $L(\theta)$ 最小。
\(\theta \leftarrow \theta - \alpha \nabla_{\theta} L(\theta)\)</p>

<p>其中，$\alpha$ 是学习率。采用分离拷贝思路后，损失函数的梯度可以写为</p>

\[\nabla_{\theta} L(\theta) = \alpha[r_{t+1}+\gamma\max_a q(s_{t+1},a; \theta)−q(s_t,a_t; \theta)]\nabla_{\theta}  q(s_t,a_t; \theta)\]

<p>可以看出，我们从 Q-Learning 的 TD Error 出发定义出损失函数，对损失函数求梯度可得价值梯度。通过梯度下降找到最优参数 $\theta$，进而得到最优价值函数。</p>

<p>实际上，价值梯度并没有严格的定义，因为我们并不关心其具体形式，上述损失函数已经可以保证我们找到最优网络参数。可以粗略的认为，狭义的价值梯度是 $\nabla_{\theta} q(s_t,a_t; \theta)$，而广义的价值梯度即为损失函数的梯度。</p>

<h4 id="232-策略梯度"><span class="me-2">2.3.2. 策略梯度</span><a href="#232-策略梯度" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>类似地，我们需要定义一个策略梯度来更新神经网络的参数，最终使得策略达到最优。神经网络的输出是前面定义的策略函数 $\pi(a \vert s;\theta)$，那么损失函数的表达式中必然要「显式包含」策略函数，这样才能衡量输出和真值之间的误差，即</p>

\[J(\theta) = J(\pi(a\vert s;\theta))\]

<p>如果能给出上述损失函数的表达式，更进一步如果能直接给出损失函数梯度的表达式，就可以直接进行梯度下降（上升？）更新网络参数</p>

\[\theta \leftarrow \theta + \alpha \nabla_\theta J(\pi(a\vert s ; \theta))\]

<p>若我们定义 <strong>策略梯度</strong> 为上述损失函数的梯度，那么问题就转化为：</p>

<ul>
  <li>损失函数 $J(\pi(a\vert s;\theta))$ 的具体形式是什么？</li>
  <li>损失函数的梯度（即策略梯度）$\nabla_\theta J(\pi(a\vert s;\theta))$ 的具体形式是什么？</li>
  <li>如何计算损失函数的梯度（即策略梯度）？梯度下降还是梯度上升？</li>
</ul>

<h2 id="3-策略梯度的计算"><span class="me-2">3. 策略梯度的计算</span><a href="#3-策略梯度的计算" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="31-基于累计奖励的策略梯度"><span class="me-2">3.1. 基于累计奖励的策略梯度</span><a href="#31-基于累计奖励的策略梯度" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>回想强化学习的目标是使得获得的奖励最大化，因此计算策略梯度的目的，也是为了更新神经网络的参数，使神经网络产生的能够得到大的奖励的动作的概率变大，即得到更优的策略使得获得的奖励最大化。</p>

<p>神经网络的输出为策略函数 $\pi(a\vert s;\theta)$，其中 $\theta$ 是神经网络的参数。假设采样一条马尔科夫轨迹如下</p>

\[\tau = {s_1,a_1,r_1,s_2,a_2,r_2,...,s_T,a_T,r_T}\]

<p>那么该轨迹发生的概率为</p>

\[p_{\theta}(\tau) = p(s_1)\prod_{t=1}^T \pi(a_t\vert s_t;\theta)p(s_{t+1}\vert s_t,a_t)\]

<p>其中，$p(s_1)$ 为初始状态的概率；$p(s_{t+1}\vert s_t,a_t)$ 为环境转移概率。注意这两个概率均与网络参数无关。</p>

<p>不考虑折扣衰减，该轨迹获得的累计奖励为</p>

\[R(\tau) = \sum_{t=0}^T r_t\]

<p>因此我们可以定义目标函数为</p>

\[\textcolor{blue}{J(\theta) = \mathbb{E} [R(\tau)] = \mathbb{E}\left[\sum_{t=1}^T r_t\right]}\]

<p>由于马尔科夫链是采样得到的，因此当前策略可获得的期望奖励为</p>

\[\mathbb{E} [R(\tau)] = \sum_{\tau} p_{\theta}(\tau)R(\tau)\]

<p>定义<strong>策略梯度</strong>为</p>

\[\nabla_{\theta}J(\theta) = \nabla_{\theta}\mathbb{E} [R(\tau)] = \nabla_{\theta}\sum_{\tau} p_{\theta}(\tau) R(\tau) = \sum_{\tau} \nabla_{\theta}p_{\theta}(\tau) R(\tau)\]

<p>注意，强化学习的目的是最大化这个期望奖励，因此需要用梯度上升来更新神经网络参数。</p>

\[\theta \leftarrow \theta + \alpha \nabla_{\theta} J(\theta)\]

<ul>
  <li><strong>问题转化为</strong>：如何计算 $\nabla_{\theta}p_{\theta}(\tau)$</li>
</ul>

<p>注意到 $p_{\theta}(\tau)$ 是许多概率连乘的形式，如果直接计算其梯度，势必存在数据下溢（概率都是小于等于 1 的，多个概率连乘后数值会非常小），需要想办法避免。一种直觉思路是通过取 对数 把连乘转化为连加。</p>

<p>对 $\ln f(x)$ 函数求梯度具备如下性质</p>

\[\nabla_{x} \ln f(x) = \frac{\nabla_{x} f(x)}{f(x)}\]

<p>因此有</p>

\[\nabla_{x} f(x) = f(x)\nabla_{x} \ln f(x)\]

<p>将 $p_{\theta}(\tau)$ 带入即可得</p>

\[\nabla_{\theta}p_{\theta}(\tau) = p_{\theta}(\tau)\nabla_{\theta} \ln p_{\theta}(\tau)\]

<p>因此有</p>

\[\begin{aligned}
\nabla_{\theta}J(\theta) &amp;= \sum_{\tau} \nabla_{\theta}p_{\theta}(\tau) R(\tau)\\
&amp;= \sum_{\tau} p_{\theta}(\tau)\nabla_{\theta} \ln p_{\theta}(\tau) R(\tau) \\
&amp;=\mathbb{E}_{\tau\sim p_{\theta(\tau)}}[\nabla_{\theta} \ln p_{\theta}(\tau) R(\tau)]
\end{aligned}\]

<ul>
  <li><strong>问题转化为</strong>：如何计算 $\nabla_{\theta} \ln p_{\theta}(\tau)$</li>
</ul>

<p>首先通过蒙特卡洛方法进行 $N$ 次采样来近似估计期望</p>

\[\begin{aligned}
\nabla_{\theta}J(\theta) &amp;=\mathbb{E}_{\tau\sim p_{\theta(\tau)}}[\nabla_{\theta} \ln p_{\theta}(\tau) R(\tau)]\\
&amp;=\frac{1}{N} \sum_{n=1}^N \nabla_{\theta} \ln p_{\theta}(\tau_n) R(\tau_n)
\end{aligned}\]

<p>其中，$\tau_n$ 是第 $n$ 次采样得到的轨迹。那么对于这条具体的轨迹有</p>

\[\begin{aligned}
\nabla_{\theta} \ln p_{\theta}(\tau_n) &amp;= \nabla_{\theta} \left[\ln p(s_1) + \sum_{t=1}^T \ln \pi_{\theta}(a_t\vert s_t) +\sum_{t=1}^T \ln p(s_{t+1}\vert s_t,a_t)\right]_n\\
&amp;= \nabla_{\theta}\sum_{t=1}^T\ln \pi_{\theta}(a_t^n\vert s_t^n)
= \sum_{t=1}^T\nabla_{\theta}\ln \pi_{\theta}(a_t^n\vert s_t^n)\\
\end{aligned}\]

<p>上式可以看出，利用对数函数把连乘转为连加的好处在于。中第一项和第三项与网络参数 $\theta$ 无关，因此对其求梯度为 0，仅剩第二项。</p>

<p>带回前式可得到如下更新式</p>

\[\nabla_{\theta}J(\theta) = \frac{1}{N}\sum_{n=0}^N \sum_{t=1}^T \nabla_{\theta}\ln \pi_{\theta}(a_t^n\vert s_t^n) R(\tau_n)\]

<p>最后，重新把策略梯度写为期望的形式，有</p>

\[\textcolor{red}{\nabla_{\theta}J(\theta)=\mathbb{E} [\nabla_{\theta}\ln \pi_{\theta}(A\vert S) R]}\]

<p>上述策略梯度存在一个局限，即只适用于蒙特卡洛采样能够采样到终止状态的情况，此时累计奖励可以计算得到特定的值。如果采样无法达到终止状态，轨迹就无限延申，就无法计算累计奖励了。</p>

<h3 id="32-基于初始状态价值的策略梯度"><span class="me-2">3.2. 基于初始状态价值的策略梯度</span><a href="#32-基于初始状态价值的策略梯度" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>为了解决基于累计奖励的策略梯度在蒙特卡洛采样无限时无法求解问题，引入折扣因子，对应的目标函数为</p>

\[\textcolor{blue}{J(\theta) = \mathbb{E} [R(\tau)]=  \mathbb{E}[\sum_{t=1}^T \gamma^{t-1} r_t]}\]

<p>注意到，上式右侧的求和就是回报的定义式（累计奖励的折扣和），带上期望就是价值函数的定义式，相当于利用<strong>初始状态的状态价值函数</strong>来衡量轨迹的优劣，因此有</p>

\[J(\theta) = V_{\pi}(s)\]

<p>那么有</p>

\[\nabla_{\theta}J(\theta) = \nabla_{\theta}V_{\pi}(s)\]

<p>上述策略梯度没有显式包含策略函数 $\pi_{\theta}(a\vert s)$，需要通过策略梯度定理将其进一步展开。</p>

<h3 id="33-策略梯度定理"><span class="me-2">3.3. 策略梯度定理</span><a href="#33-策略梯度定理" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>首先使用贝尔曼期望方程对 $V_{\pi}(s)$ 进行展开</p>

\[\nabla_{\theta}V_{\pi}(s) = \nabla_{\theta}\sum_{a\in \mathcal{A(s)}} \pi(a\vert s)q_{\pi}(s,a) = \sum_{a\in \mathcal{A(s)}}\nabla_{\theta}[\pi(a\vert s)q_{\pi}(s,a)]\]

<p>注意到求梯度是对网络参数 $\theta$ 进行的，而所有和策略 $\pi$ 有关的项均隐含 $\theta$，所以上述式子需要采用乘法求导的形式展开</p>

\[\begin{aligned}
\nabla_{\theta}V_{\pi}(s) &amp;= \sum_{a\in \mathcal{A(s)}}\nabla_{\theta} [\pi(a\vert s)q_{\pi}(s,a)]\\
&amp;= \sum_{a\in \mathcal{A(s)}} [\nabla_{\theta}\pi(a\vert s) q_{\pi}(s,a) + \pi(a\vert s) \nabla_{\theta}q_{\pi}(s,a)]\\
\end{aligned}\]

<p>其中<strong>第二项</strong></p>

\[\begin{aligned}
\nabla q_{\pi} (s,a) &amp;= \nabla \sum_{s^\prime,r} P(s^\prime,r\vert s,a)[r+\gamma V_{\pi}(s^\prime)]\\
&amp;=\nabla \sum_{s^\prime,r}^{s^\prime,r}  P(s^\prime,r|s,a)  r + \nabla \sum_{s^\prime,r} \gamma P(s^\prime,r|s,a)V_{\pi}(s^\prime)\\
&amp;=\nabla \sum_{s^\prime,r} \gamma P(s^\prime,r|s,a)V_{\pi}(s^\prime)\\
&amp;=\gamma \sum_r P(r\vert s,a)\sum_{s^\prime} P(s^\prime\vert s,a) \nabla V_{\pi}(s^\prime)\\
&amp;=\gamma \sum_{s^\prime} P(s^\prime\vert s,a) \nabla V_{\pi}(s^\prime)
\end{aligned}\]

<p>带回梯度式子，即</p>

\[\nabla_{\theta}V_{\pi}(s) = \sum_{a\in \mathcal{A(s)}} \nabla_{\theta}\pi(a\vert s) q_{\pi}(s,a) + \sum_{a\in \mathcal{A(s)}} \pi(a\vert s)\gamma \sum_{s^\prime} P(s^\prime\vert s,a) \nabla_{\theta} V_{\pi}(s^\prime)\]

<p>可以看出，上式呈现出 $\nabla_{\theta}V_{\pi}(s)$ 的迭代形式。为了更进一步确定迭代关系，再次对 $\nabla_{\theta}V_{\pi}(s^\prime)$ 展开，有</p>

\[\nabla_{\theta}V_{\pi}(s^\prime) = \sum_{a^\prime\in \mathcal{A(s^\prime)}} \nabla_{\theta}\pi(a^\prime\vert s^\prime) q_{\pi}(s^\prime,a^\prime) + \sum_{a^\prime\in \mathcal{A(s^\prime)}} \pi(a^\prime\vert s^\prime)\gamma \sum_{s^{\prime\prime}} P(s^{\prime\prime}\vert s^\prime,a^\prime) \nabla_{\theta} V_{\pi}(s^{\prime\prime})\]

<p>带回梯度式子并且<strong>完全展开</strong>，有</p>

<ul>
  <li><strong>第一项</strong></li>
</ul>

\[\sum_{a\in \mathcal{A(s)}} \nabla_{\theta}\pi(a\vert s) q_{\pi}(s,a)\]

<ul>
  <li>
    <p><strong>第二项</strong></p>

\[\begin{aligned}
      &amp;\sum_{a\in \mathcal{A(s)}} \pi(a\vert s)\gamma \sum_{s^\prime} P(s^\prime\vert s,a)\cdot \sum_{a^\prime\in \mathcal{A(s^\prime)}} \nabla_{\theta}\pi(a^\prime\vert s^\prime) q_{\pi}(s^\prime,a^\prime) \\
      =&amp;\gamma \sum_{s^\prime}\sum_{a\in \mathcal{A(s)}} \pi(a\vert s) P(s^\prime\vert s,a)\cdot \sum_{a^\prime\in \mathcal{A(s^\prime)}} \nabla_{\theta}\pi(a^\prime\vert s^\prime) q_{\pi}(s^\prime,a^\prime) \\
      =&amp;\gamma \sum_{s^\prime} \mathcal{P}(s^\prime\vert s)\cdot \sum_{a^\prime\in \mathcal{A(s^\prime)}} \nabla_{\theta}\pi(a^\prime\vert s^\prime) q_{\pi}(s^\prime,a^\prime)\\
      \end{aligned}\]

    <p>上式仅包含前后状态的变量 $s,s^\prime$ 和转移次数常量 $k=1$（$a$ 最终会被求和吸收积分掉），因此可进一步写为通项式：</p>

\[\gamma \sum_{x\in S} \mathcal{P}(s\rightarrow x, k, \pi)\cdot \sum_{a\in \mathcal{A(s)}} \nabla_{\theta}\pi(a\vert x) q_{\pi}(x,a)\]

    <p>同时，注意到第一项也符合上述通项式（$k=0,\gamma = 1$）</p>
  </li>
  <li>
    <p><strong>第三项</strong></p>

    <p>\(\sum_{a\in \mathcal{A(s)}} \pi(a\vert s)\gamma \sum_{s^\prime} P(s^\prime\vert s,a) \cdot \sum_{a^\prime\in \mathcal{A(s^\prime)}} \pi(a^\prime\vert s^\prime)\gamma \sum_{s^{\prime\prime}} P(s^{\prime\prime}\vert s^\prime,a^\prime) \nabla_{\theta} V_{\pi}(s^{\prime\prime})\)
注意到第三项仍然是个迭代式，可以继续展开，且展开除了最后一项，前面均符合前述通项式。</p>
  </li>
</ul>

<p>至此， $\nabla_{\theta} V_\pi(s)$ 的迭代式表示如下</p>

\[\nabla_{\theta}V_{\pi}(s) = \sum_{s\in S} \sum_{k=0}^{\infty} \gamma^{k} \mathcal{P}(s\rightarrow x, k, \pi)\cdot \sum_{a\in \mathcal{A(s)}} \nabla_{\theta}\pi(a\vert x) q_{\pi}(x,a)\]

<p>将公式中所有 $s$ 替换为初始状态 $s_0$，将所有 $x$ 替换为 $s$，可得</p>

\[\nabla_{\theta}V_{\pi}(s_0) = \sum_{s\in S} \sum_{k=0}^{\infty} \gamma^{k} \mathcal{P}(s_0\rightarrow s, k, \pi)\cdot \sum_{a\in \mathcal{A(s)}} \nabla_{\theta}\pi(a\vert s) q_{\pi}(s,a)\]

<p>其中，</p>

<ul>
  <li>$\mathcal{P}(s_0\rightarrow s, k, \pi)$ 表示初始状态 $s_0$ 经过 $k$ 次状态转移最终到达 $s$ 的概率；</li>
  <li>$\sum_{k=0}^{\infty} \mathcal{P}(s_0\rightarrow s, k, \pi)$ 表示在整条轨迹序列中，状态 $s$ 出现的<strong>平均次数</strong>，将其记为 $\eta(s)$；</li>
  <li>那么状态 $s$ 出现的<strong>概率</strong> $\mu(s)$ 可定义为其出现的平均次数除以所有状态出现的平均次数的和，即 $\mu(s) = {\eta(s)}/{\sum_{s^\prime} \eta(s^\prime)}$</li>
</ul>

<p>则</p>

\[\begin{aligned}
\nabla_{\theta}V_{\pi}(s_0) &amp;= \sum_{s\in S}  \gamma^{k} \eta(s) \cdot \sum_{a\in \mathcal{A(s)}} \nabla_{\theta}\pi(a\vert s) q_{\pi}(s,a)\\
&amp;= \sum_{s\in S}  \gamma^{k} \mu(s)\sum_{s^\prime\in S} \eta(s^\prime)  \cdot \sum_{a\in \mathcal{A(s)}} \nabla_{\theta}\pi(a\vert s) q_{\pi}(s,a)\\
&amp;= \sum_{s^\prime\in S}\left(\sum_{s\in S} \eta(s^\prime) \gamma^{k} \mu(s) \right) \cdot \sum_{a\in \mathcal{A(s)}} \nabla_{\theta}\pi(a\vert s) q_{\pi}(s,a)\\
\end{aligned}\]

<p>我们希望把前面对状态 $s$ 的求和重新表示为某种期望的形式</p>

\[\nabla_{\theta}J(\theta) =\mathbb{E}_{?}\left[ \sum_{a\in \mathcal{A(s)}} \nabla_{\theta}\pi(a\vert s) q_{\pi}(s,a) \right]\]

<p>问题转化为，确定期望符号中的概率分布是什么（也即上式中的 <code class="language-plaintext highlighter-rouge">?</code> 部分）。既然是分布，不妨假设其概率分布为 $\rho_\pi(s)$，该分布不仅和策略函数 $\pi(a\vert s;\theta)$ 相关，还与环境（状态转移概率）相关，那么策略梯度变为</p>

\[\begin{aligned}
\nabla_{\theta}V_{\pi}(s_0) &amp;\doteq \sum_{s^\prime\in S}\rho_{\pi}(s^\prime) \cdot \sum_{a\in \mathcal{A(s)}} \nabla_{\theta}\pi(a\vert s) q_{\pi}(s,a)\\
&amp;= \sum_{s\in S}\rho_{\pi}(s) \cdot \sum_{a\in \mathcal{A(s)}} \nabla_{\theta}\pi(a\vert s) q_{\pi}(s,a)
\end{aligned}\]

<p>则</p>

\[\nabla_{\theta}J(\theta) = \mathbb{E}_{s\sim \rho_{\pi}(s)}\left[ \sum_{a\in \mathcal{A(s)}} \nabla_{\theta}\pi(a\vert s) q_{\pi}(s,a) \right]\]

<p>继续观察，上式还存在一个求和符号，因此存在一个想法是将该部分也化为期望的形式。但该求和符号的消除需要借助策略函数，因此需要对 $\nabla_{\theta}\pi(a\vert s;\theta)$ 进行变换，借助之前 $\ln f(x)$ 函数梯度的性质，有</p>

\[\begin{aligned}
\nabla_{\theta}J(\theta) = &amp; \mathbb{E}_{s\sim \rho_{\pi}(s)}\left[ \sum_{a\in \mathcal{A(s)}} \nabla_{\theta}\pi(a\vert s;\theta) q_{\pi}(s,a) \right]\\
= &amp; \mathbb{E}_{s\sim \rho_{\pi}(s)}\left[ \sum_{a\in \mathcal{A(s)}} \pi(a\vert s;\theta)\nabla_{\theta}\ln\pi(a\vert s;\theta) q_{\pi}(s,a) \right]\\
= &amp; \mathbb{E}_{s\sim \rho_{\pi}(s), a\sim \pi} \left[ \nabla_{\theta}\ln\pi(a\vert s;\theta) q_{\pi}(s,a) \right]\\
\end{aligned}\]

<p>将期望的下标进行简化，最终我们得到了一般形式的基于初始状态价值的策略梯度</p>

\[\textcolor{red}{\nabla_{\theta}J(\theta) = \mathbb{E} \left[ \nabla_{\theta}\ln\pi(A\vert S;\theta) q_{\pi}(S,A) \right]}\]

<blockquote>
  <p>上式中的 “=” 并非严格意义的相等，而是包含 ”相等、约等于、正比于“ 三种形式，具体形式与折扣因子取值、初始状态分布有关。</p>

  <p>有关策略改进定理还可参考：https://zhuanlan.zhihu.com/p/491647161</p>
</blockquote>

<p>注意，同样需要用梯度上升来更新神经网络参数</p>

\[\theta \leftarrow \theta + \alpha \nabla_{\theta} J(\theta)\]

<h2 id="4-基于策略梯度的参数更新"><span class="me-2">4. 基于策略梯度的参数更新</span><a href="#4-基于策略梯度的参数更新" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>梯度上升算法中，将待更新参数的下标加上，得到如下更加严谨的形式</p>

\[\begin{aligned}
  \theta_{t+1} &amp;= \theta_t + \alpha \nabla_{\theta_t} J(\theta)\\
 &amp;= \theta_t + \alpha \mathbb{E} \left[ \nabla_{\theta_t}\ln\pi(A\vert S;\theta_t) q_{\pi}(S,A) \right]\\
\end{aligned}\]

<p>期望符号可以通过「随机梯度下降」的方式来消除</p>

\[\theta_{t+1} = \theta_t + \alpha \nabla_{\theta_t}\ln\pi(a\vert s;\theta_t) q_{\pi}(s,a)\]

<p>期望符号包含了对 $S,A$ 的采样，其中</p>

<ul>
  <li>$S \sim d $ 或 $S \sim \rho$ 是策略 $\pi$ 下的长期分布，但实际上我们有样本就不错了，所以实际应用中不考虑；</li>
  <li>$A \sim \pi(A\vert S;\theta)$ 需要实际采样才能得到，因此策略梯度法是个 on-policy 方法。</li>
</ul>

<p>虽然消除了期望符号，但其中涉及的 $q_{\pi}(s, a)$ 仍然未知，有两种近似求解的思路：</p>

<ul>
  <li>MC：使用 Monte-Carlo 采样得到真实回报 $G_t$ 来近似估计，称其为 REINFORCE；</li>
  <li>TD：使用时序差分算法，对应 Actor-Critic 等一系列方法。</li>
</ul>

<h3 id="41-reinforce"><span class="me-2">4.1. REINFORCE</span><a href="#41-reinforce" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>根据 Q 函数的定义有</p>

\[q_{\pi_{\theta}}(s_t, a_t) = \mathbb{E} [G_t\vert s_t, a_t]\]

<p>带入策略梯度定理有</p>

\[\nabla_{\theta}J(\theta) \propto \mathbb{E} \left[ \nabla_{\theta}\ln\pi(a_t\vert s_t;\theta) G_t \right]\]

<p>至此，我们可以通过采样 $\nabla_{\theta}\ln\pi(a_t\vert s_t;\theta) G_t$ 神经网络参数 $\theta$ 进行更新。这就是 <strong>REINFORECE</strong>。REINFORCE 的本质就是用 $G_t$ 代替 $q_{\pi}(s_t, a_t)$。</p>

<p>用于估计最优策略的REINFORCE算法表示如下（采用增量更新的方式）</p>

<hr />
<ul>
  <li><strong>输入</strong>：可微策略函数 $\pi(a \vert s;\theta)$，衰减因子 $\gamma$，学习率 $\alpha$</li>
  <li><strong>初始化</strong>：策略函数的参数 $\theta$</li>
  <li><strong>训练过程</strong>：
    <ul>
      <li>repeat 根据 $\pi_{\theta}$ 采样一条轨迹：$s_0, a_0, r_1, s_2, a_2, r_3, \cdots$</li>
      <li>loop $t=T-1, T-2, \cdots, 1,0$
        <ul>
          <li>$\quad G\leftarrow \gamma G + r_{t+1}$</li>
          <li>$\quad \theta \leftarrow \theta + \alpha \nabla_{\theta}\ln\pi(a_t\vert s_t;\theta) G $</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<hr />

<p>根据定义，因为 $G_t$ 是 $Q(s,a)$ 的无偏估计，所以基于蒙特卡洛采样的方式进行参数更新的 REINFORCE 算法，得到的结果就是策略梯度的无偏估计，那么其方差呢？</p>

<p>结论：基于蒙特卡洛采样的方式进行参数更新的 REINFORCE 算法方差很大。通过观察策略梯度式</p>

\[\nabla_{\theta}J(\theta) \propto \mathbb{E} \left[ \nabla_{\theta}\ln\pi(a_t\vert s_t;\theta) G_t \right]\]

<p>我们可以看出，$\nabla_{\theta}\ln\pi(a_t\vert s_t;\theta)$ 相当于 $G$ 的一个系数或者说权重，对于方差而言只起到放缩作用（根据公式 $Var(aX) = a^2Var(X)$），实际方差还是取决于 $G$ 本身。而 $G$ 的方差</p>

\[Var(G_t) = Var(R_{t+1}) + Var(R_{t+2}) + \cdots\]

<p>由此可以看出，方差大来源于两个原因：</p>

<ul>
  <li>若不同 $s$ 对应的 $R$ 范围相差较大，再加上 MC 的随机性，那么每一步的 $R$ 都会有较大的方差;</li>
  <li>因为采样轨迹长度的原因，出现方差累积。</li>
</ul>

<p>相应的解决方法如下：</p>
<ul>
  <li>通过添加基线缓解;</li>
  <li>使用 TD 方法代替 MC 方法，即通过Actor-Critic方法解决。</li>
</ul>

<h3 id="42-reinforce-with-baseline"><span class="me-2">4.2. REINFORCE with baseline</span><a href="#42-reinforce-with-baseline" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>通过添加基线（baseline）可以减小方差。具体形式如下</p>

\[\nabla_{\theta}J(\theta) \propto \mathbb{E} \left[ \nabla_{\theta}\ln\pi(a_t\vert s_t;\theta) G_t \right]\]

<p>添加基线 $b(s)$ 后，目标函数的梯度变为</p>

\[\nabla_{\theta}J(\theta) \propto \mathbb{E} \left[ \nabla_{\theta}\ln\pi(a_t\vert s_t;\theta) (G_t-b(s_t)) \right]\]

<p>参数更新方式变为</p>

\[\theta \leftarrow \theta + \alpha (G_t - b(s_t)) \nabla_{\theta}\ln\pi(a_t\vert s_t;\theta)\]

<p>基线 $b(s)$ 可为不与动作 $a$ 有关的任意变量或者函数，因为它并不会改变策略梯度的期望，证明如下</p>

\[\begin{aligned}
\nabla_{\theta}J(\theta) &amp;\propto \mathbb{E} \left[ \nabla_{\theta}\ln\pi(a_t\vert s_t;\theta) (G_t-b(s_t)) \right]\\
&amp;\propto \sum_{a}\pi(a\vert s) \nabla_{\theta}\ln \pi(a\vert s;\theta)(G_t-b(s_t))\\
&amp;\propto \sum_{a} \nabla_{\theta}\pi(a\vert s;\theta)(G_t-b(s_t))
\end{aligned}\]

<p>因为 $b(s)$ 与动作 $a$ 无关，可以提到求和符号外面，但注意 $G_t$ 不可以提到求和符号外面</p>

\[\begin{aligned}
\nabla_{\theta}J(\theta) &amp;\propto \sum_{a} \nabla_{\theta}\pi(a\vert s;\theta)(G_t-b(s_t))\\
&amp;\propto \sum_{a}  G_t \nabla_{\theta}\pi(a\vert s;\theta) - b(s_t) \sum_{a} \nabla_{\theta}\pi(a\vert s;\theta)\\
\end{aligned}\]

<p>对于后一项，交换梯度符号和求和符号，有</p>

\[b(s_t) \sum_{a} \nabla_{\theta}\pi(a\vert s;\theta) =b(s_t)\nabla_{\theta} \sum_{a} \pi(a\vert s;\theta)  = b(s_t)\nabla_{\theta} 1 = 0\]

<p>得证。</p>

<blockquote>
  <p>关于基线的更多内容参考：https://zhuanlan.zhihu.com/p/636907461</p>
</blockquote>

<p>为什么引入基线可以减小方差？证明如下：</p>

<p>首先根据方差的定义</p>

\[Var(X) = E(X^2)-E(X)^2\]

<p>那么有</p>

\[Var(\nabla_{\theta}J(\theta)) = Var(\nabla_{\theta}^2)-\nabla_{\theta}^2 E(\nabla_{\theta})\]

<p>我们又知道引入基线不改变期望，因此方差的第二项取值与是否包含基线无关，则只需要关注第一项即可</p>

\[\begin{aligned}
Var \nabla_{\theta}J(\theta)^2 &amp;= E[\nabla_{\theta}\ln\pi_{\theta}(a_t\vert s_t)^2\cdot (G_t - b(s_t))^2] \\
 &amp;= E[\nabla_{\theta}\ln\pi_{\theta}(a_t\vert s_t)^2]\cdot E[(G_t - b(s_t))^2]
\end{aligned}\]

<p>思考：什么基线能使上式取到最小值？$\to$ 这是一个求极值问题 $\to$ 上式对基线求偏导并另其为零。</p>

\[\begin{aligned}
&amp;\frac{\partial}{\partial b(s_t)}Var\nabla_{\theta}J( \theta )^2=\mathbb{E}\{2\left( G_t-b( s_t ) \right) [ \nabla _{\theta}\ln \pi _{\theta}( a_t|s_t ) ^2 ] \}=0\\
\Rightarrow &amp; \mathbb{E}\{G_t [ \nabla _{\theta}\ln \pi _{\theta}( a_t|s_t ) ^2 ] \}=\mathbb{E}\{b( s_t ) [ \nabla _{\theta}\ln \pi _{\theta}( a_t|s_t ) ^2 ] \}
\end{aligned}\]

<p>则</p>

\[b(s_t) = \frac{\mathbb{E}\{G_t [ \nabla _{\theta}\ln \pi _{\theta}( a_t|s_t ) ^2 ] \}}{\mathbb{E}[ \nabla _{\theta}\ln \pi _{\theta}( a_t|s_t ) ^2 ]}\]

<p>当基线是关于 $G_t$ 期望的上述估计时，方差最小。上述估计是一个对 $G_t$ 的带权重估计值，但其中权重的求解需要用到梯度信息，这是未知的。因此实际情况中我们也不会用这个理论最优的基线。</p>

<p>实际情况中，我们直接忽略权重，将基线设置为次优的情况</p>

\[\begin{aligned}
&amp;b(s) = \mathbb{E}[G_t] = \mathbb{E}(G_t \vert s=s_t) = v_\pi(s)\\
\text{or}\quad &amp;b(s) = \mathbb{E}[G_t] = \mathbb{E}(G_t \vert s=s_t,a=a_t) = q_{\pi}(s,a)
\end{aligned}\]

<ul>
  <li>对于第一种次优情况，相当于将基线设为「状态价值函数」；</li>
  <li>对于第二种次优情况，相当于将基线设为「状态-动作价值函数」。</li>
</ul>

<h3 id="43-actor-critic-related-to-v"><span class="me-2">4.3. Actor-Critic (related to V)</span><a href="#43-actor-critic-related-to-v" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>当基线函数选为 状态价值函数时，更进一步，因为 REINFORCE 本身是基于蒙特卡洛方法，那么自然而然可以同样使用蒙特卡洛方法来学习该状态价值函数，即</p>

\[b(s) = {v}(s_t;{w})\]

<p>其中 $w$ 是另一套习得的参数。此时，策略梯度的表达式变为</p>

\[\nabla_{\theta}J(\theta) \propto \mathbb{E} \left[ \nabla_{\theta}\ln\underbrace{\pi(a_t\vert s_t;\theta)}_{\text{actor}} (G_t-\underbrace{v(s_t;w)}_{\text{critic}}) \right]\]

<p>到此为止，我们就可以将 REINFORCE 算法转化为 Actor-Critic 算法，其中参数 $\theta$ 对应策略梯度部分的神经网络，扮演 Actor 的角色；而 $w$ 对应价值估计部分的神经网络，扮演 Critic 的角色。</p>

<p>更进一步，类似于基于价值的强化学习方法中，MC 到 TD 方法的逻辑演变，这里我们同样不需要采样完整的一条轨迹，而是仅采样一步，后续通过自举的方式逐步估计完整的轨迹，对应策略梯度表达式变为</p>

\[\nabla_{\theta}J(\theta) \propto \mathbb{E} \left[ \nabla_{\theta}\ln\underbrace{\pi(a_t\vert s_t;\theta)}_{\text{actor}} (R_{t+1}+\gamma \underbrace{v(s_{t+1};w)-v(s_t;w)}_{\text{critic}}) \right]\]

<p>此时价值网络的更新形式为</p>

\[\begin{aligned}
\delta_t &amp;= R_{t+1}+\gamma v(s_{t+1};\omega)-v(s_t;\omega)\\
J(\omega) &amp;= \frac{1}{2} \delta_t^2\\
\omega &amp;\leftarrow \omega - \alpha_{\omega} \delta_t \nabla_{\omega}v(s;\omega)
\end{aligned}\]

<p>此时策略网络的更新形式为</p>

\[\begin{aligned}
\delta_t &amp;= R_{t+1} + \gamma {v}(s_{t+1};w)-{v}(s_t;{w})\\
\nabla_{\theta}J(\theta) &amp;\propto \mathbb{E} \left[ \nabla_{\theta}\ln\pi(a_t\vert s_t;\theta) \delta_t \right]\\
\theta &amp;\leftarrow \theta + \alpha \delta_t \nabla_{\theta}\ln\pi(a_t\vert s_t;\theta)
\end{aligned}\]

<p>算法的训练的伪代码如下，该算法又被简称为 「<strong>V Actor-Critic（VAC）算法</strong>」</p>

<hr />
<ul>
  <li><strong>输入</strong>：
    <ul>
      <li>可微策略函数 $\pi(a \vert s;\theta)$</li>
      <li>可微的价值函数 ${v}(s;w)$</li>
      <li>衰减因子 $\gamma$，学习率 $\alpha_\theta,\alpha_w$</li>
    </ul>
  </li>
  <li><strong>初始化</strong>：
    <ul>
      <li>策略函数的参数 $\theta$</li>
      <li>价值函数的参数 $w$</li>
    </ul>
  </li>
  <li><strong>训练过程</strong>：
    <ul>
      <li>loop 状态 $s$ 没有结束时
        <ul>
          <li>根据策略采样：$a\sim \pi(\cdot, s;\theta)$</li>
          <li>执行动作 $a$， 得到奖励 $R$，转移状态到 $s^\prime$</li>
          <li>$\delta \leftarrow R + \gamma {v}(s^\prime;w) - {v}(s;w)$</li>
          <li>$w \leftarrow w + \alpha_w \delta\nabla_{w}{v}(s;w)$</li>
          <li>$\beta \leftarrow \gamma \delta$</li>
          <li>$\theta \leftarrow \theta + \alpha \beta \nabla_{\theta}\ln\pi(a_t\vert s_t;\theta)$</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<hr />

<h3 id="44-actor-critic-related-to-q"><span class="me-2">4.4. Actor-Critic (related to Q)</span><a href="#44-actor-critic-related-to-q" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>若采用状态-动作价值函数 $q(s,a)$ 作为基线函数，并使用神经网络对其进行估计，有</p>

\[b(s_t) = q(s_t, a_t;\omega)\]

<p>此时策略梯度表达式为</p>

\[\nabla_{\theta}J(\theta) \propto \mathbb{E} \left[ \nabla_{\theta}\ln\underbrace{\pi(a_t\vert s_t;\theta)}_{\text{actor}} (R_{t+1}+\gamma \underbrace{q(s_{t+1},a_{t+1};w)-q(s_t,a_t;w)}_{\text{critic}}) \right]\]

<p>此时价值网络的更新形式为</p>

\[\begin{aligned}
\delta_t &amp;= R_{t+1}+\gamma q(s_{t+1}, a_{t+1};\omega)-q(s_t, a_t;\omega)\\
J(\omega) &amp;= \frac{1}{2} \delta_t^2\\
\omega &amp;\leftarrow \omega - \alpha_{\omega} \delta_t \nabla_{\omega}q(s,a;\omega)
\end{aligned}\]

<blockquote>
  <p>注意到，这里实际上就是采用 <u>SARSA 值函数近似</u> 来进行价值网络更新。</p>
</blockquote>

<p>对于策略网络的目标函数的梯度，应该使用原始的策略梯度形式，此时策略网络的更新形式为</p>

\[\begin{aligned}
\nabla_{\theta}J(\theta) &amp;\propto \mathbb{E} [ \nabla_{\theta}\ln\pi(a_t\vert s_t;\theta) q(s_t,a_t;\omega)]\\
\theta &amp;\leftarrow \theta + \alpha_{\theta}{q(s,a;\omega)}\nabla_{\theta}\ln\pi(a_t\vert s_t;\theta) 
\end{aligned}\]

<p>该算法又被简称为 「<strong>Q Actor-Critic（QAC）算法</strong>」。</p>

<h3 id="45-advantage-actor-critic-a2c"><span class="me-2">4.5. Advantage Actor-Critic (A2C)</span><a href="#45-advantage-actor-critic-a2c" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>前面介绍 REINFORCE 的时候，我们通过引入基线降低方差，并且表明将基线函数设为价值函数是一个较优的选择。</p>

<p>本着这种思想，我们再次回顾策略梯度的原始目标函数梯度式，然后对其引入状态价值函数 $v_{\pi}(s_t)$ 作为基线，有</p>

\[\nabla_{\theta}J(\theta) \propto \mathbb{E} \left[ \nabla_{\theta}\ln\pi(a_t\vert s_t;\theta) (q_{\pi}(s_t,a_t)-v_{\pi}(s_t)) \right]\]

<p>我们称 $\textcolor{red}{\delta_t(s_t,a_t) = q_{\pi}(s_t,a_t)-v_{\pi}(s_t)}$ 为 <strong>优势函数</strong>。优势函数表示在状态 $s$ 下采取动作 $a$ 相对于平均水平的优势。</p>

<ul>
  <li>如果优势函数大于零，则说明该动作比平均动作好</li>
  <li>如果优势函数小于零，则说明当前动作还不如平均动作好。</li>
</ul>

<p>因此原先用 Critic 网络对 $q$ 函数的估计就可以改成对优势函数的估计，估算每个 $q(s_t,a_t)$ 对相对于平均值 $V(s_t)$ 的优势。这种算法就是 <strong>Advantage Actor Critic</strong> ，即 A2C。</p>

<h4 id="451-探索与利用"><span class="me-2">4.5.1. 探索与利用</span><a href="#451-探索与利用" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>根据 $\ln f(x)$ 梯度性质</p>

\[\nabla_\theta \ln\pi(a\vert s;\theta) = \frac{\nabla_\theta \pi(a\vert s;\theta)}{\pi(a\vert s;\theta)}\]

<p>则 A2C 的梯度上升式可改写为</p>

\[\begin{aligned}
\theta_{t+1} &amp;= \theta_t + \alpha \nabla_{\theta_t} \ln\pi(a_t\vert s_t;\theta_t)\delta_t(a_t,s_t)\\
&amp;= \theta_t + \alpha \left(\frac{\delta_t(a_t,s_t)}{\pi(a_t\vert s_t;\theta_t)}\right) \nabla_\theta \pi(a_t\vert s_t;\theta_t)\\
&amp;= \theta_t + \alpha \textcolor{red}{\beta_t} \nabla_\theta \pi(a_t\vert s_t;\theta_t)
\end{aligned}\]

<p>这个式子其实在优化 $\pi(a_t\vert s_t;\theta_t)$。因为根据微分的性质，当 $\theta_{t+1}-\theta_t$ 足够小时，下面的式子成立</p>

\[\pi(a_t\vert s_t;\theta_{t+1}) \approx \pi(a_t \vert s_t;\theta_t)+(\nabla_\theta \pi(a_t\vert s_t;\theta_t))^\top (\theta_{t+1}-\theta_t)\]

<p>把前面的梯度上升式带进去，得</p>

\[\begin{aligned}
\pi(a_t\vert s_t;\theta_{t+1}) &amp;\approx \pi(a_t \vert s_t;\theta_t)+(\nabla_\theta \pi(a_t\vert s_t;\theta_t))^\top (\theta_{t+1}-\theta_t)\\
&amp;=\pi(a_t \vert s_t;\theta_t)+(\nabla_\theta \pi(a_t\vert s_t;\theta_t))^\top \alpha \beta_t \nabla_\theta \pi(a_t\vert s_t;\theta_t)\\
&amp;=\pi(a_t \vert s_t;\theta_t)+ \alpha \beta_t \Vert \nabla_\theta \pi  a_t\vert s_t;\theta_t\Vert^2
\end{aligned}\]

<p>当 $\alpha_t\beta_t&gt;0$ 但值比较小时，有</p>

\[\pi(a_t\vert s_t;\theta_{t+1}) &gt; \pi(a_t\vert s_t;\theta_t)\]

<p>反之当 $\beta_t &lt; 0$ 时，有</p>

\[\pi(a_t\vert s_t;\theta_{t+1}) &lt; \pi(a_t\vert s_t;\theta_t)\]

<p>注意到，$\beta_t$ 和 $\textcolor{red}{\delta_t(a_t,s_t)}$ 成正比，和 $\pi(a_t\vert s_t;\theta_t)$ 成反比，因此</p>

<ul>
  <li>当 $\delta_t(a_t,s_t)$ 较大时，$\beta_t$ 较大，新策略会更加倾向于选择该动作，即「利用」；</li>
  <li>当 $\pi(a_t\vert s_t;\theta_t)$ 较小时，$\beta_t$ 也较大，新策略会更加倾向于选择原本小概率被选择的动作，即「探索」；</li>
</ul>

<p>所以 $\beta_t$ 可以巧妙地平衡探索和利用。并且其使用的是优势函数，其衡量了当前所选动作相对于平均基准的相对值，因此在探索和利用的平衡上更为合理。</p>

<h4 id="452-与-vac-的关系"><span class="me-2">4.5.2. 与 VAC 的关系</span><a href="#452-与-vac-的关系" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>注意到，A2C 在具体实现的时候需要同时估计 $q(s_t, a_t)$ 和 $v(s_t)$，估计一个价值函数已经会存在误差了，估计两个价值函数误差会更大。但是我们知道 $q(s_t, a_t)$ 和 $v(s_t)$ 之间是存在关系的，在具体采样时，有</p>

\[q(s_t, a_t) = r_{t+1} + \gamma v(s_{t+1})\]

<p>此时我们发现，A2C 就是前面介绍过的 VAC 算法，价值网络只用估计 $v(s_t)$ 的值就够了。</p>

<h3 id="46-重要性采样"><span class="me-2">4.6. 重要性采样</span><a href="#46-重要性采样" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>前面介绍的所有策略梯度方法都是 on-policy 方法，即实际进行动作采样的行为策略与待更新的目标策略相同，都是同一个神经网络。我们可以借鉴前面课程中（Q-Learning）介绍的方法，将其转为 off-policy 方法，这样可以更加充分利用已经采样得到的历史样本数据。</p>

<p>此处，我们引入重要性采样来实现上述转换。更加一般的情况下，重要性采样可以解决所有期望求解问题。</p>

<h4 id="461-重要性用于期望估计"><span class="me-2">4.6.1. 重要性用于期望估计</span><a href="#461-重要性用于期望估计" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>假设样本 ${x_i}$ 是由其原始分布 $p_0$ 采样得到的，其期望和方差为</p>

\[\mathbb{E}[x_i] = \mathbb{E}[X],\quad var[x_i] = var[X]\]

<p>通过大数定律来近似期望，有</p>

\[\begin{aligned}
&amp;\bar{x} = \frac{1}{n}\sum_{i=1}^n x_i\to \mathbb{E}[X],\quad \text{as } n\to \infty\\
&amp; var(\bar{x}) = \frac{1}{n}var[X]
\end{aligned}\]

<p>假设样本 $x_i$ 是由根据另外一个分布 $p_1$ 采样得到的，问题变为：能否用 $x_i\sim p_i$ 来估计样本的原始分布？为什么要做上述事情？因为对于 off-policy 方法而言，样本采样来自分布行为策略 $\beta$（$p_1$），但是目标函数（使用策略梯度）中的期望是针对目标策略的，即 $\mathbb{E}_{A\sim \pi}[\star]$。</p>

<p>重要性采样的一般流程如下：</p>

\[\mathbb{E}_{X\sim p_0}[X] = \int p_0(x)x\text{d}x = \int p_1(x)\underbrace{\frac{p_0(x)}{p_1(x)}x}_{f(x)}\text{d}x = \mathbb{E}_{X\sim p_1}[f(X)]\]

<p>即可以通过右边的期望来估计原始分布下的期望。相比原始分布下的期望，新的期望更加好求</p>

\[\begin{aligned}
\mathbb{E}_{X\sim p_1}[\bar{f}(X)] &amp;= \mathbb{E}_{X\sim p_1}[f(X)]=\frac{1}{n}\sum_{i=1}^n f(x_i),\quad \text{where } x\sim p_1\\
var_{X\sim p_1}[\bar{f}(X)] &amp;= \frac{1}{n}var_{X\sim p_1}[f(X)]
\end{aligned}\]

<p>其中 $\textcolor{red}{p_0(x)/p_1(x)}$ 被称为「<strong>重要性权重</strong>」。</p>

<p>注意到，重要性权重中出现了 $p_0(x)$，这要求 $p_0$ 已知。那既然都已知了为什么不直接求期望呢？</p>

<p>因为就算样本原始分布是已知的，其期望求解也可能是十分困难的。比如：</p>

<ul>
  <li>当 $p_0$ 的表达式十分复杂时，求积分（期望）难以计算；</li>
  <li>当 $p_0$ 是一个神经网络时，求积分（期望）求不出来；</li>
</ul>

<p>对重要性采样总结如下</p>

\[\begin{aligned}
  &amp;{x_i}\sim p_1,\\
  \bar{x} &amp;= \frac{1}{n}\sum_{i=1}^n x_i\to \mathbb{E}_{X\sim p_1}[X]\\
  \bar{f} &amp;= \frac{1}{n}\sum_{i=1}^n \frac{p_0(x_i)}{p_1(x_i)}x_i\to \mathbb{E}_{X\sim p_0}[f(X)]\\
\end{aligned}\]

<h4 id="462-重要性用于策略梯度"><span class="me-2">4.6.2. 重要性用于策略梯度</span><a href="#462-重要性用于策略梯度" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>回顾基于初始状态价值的策略梯度式，策略梯度为</p>

\[\nabla_{\theta}J(\theta) = \mathbb{E}_{s\sim \rho_{\pi}(s), \textcolor{blue}{a\sim \pi}} \left[ \nabla_{\theta}\ln\pi(a\vert s;\theta) q_{\pi}(s,a) \right]\]

<p>引入重要性采样后，假设行为策略为 $\beta$ 用于产生样本，则策略梯度为</p>

\[\nabla_\theta J(\theta) = \mathbb{E}_{S\sim \rho,\textcolor{red}{A\sim \beta}}\left[ \frac{\pi(A\vert S;\theta)}{\beta(A\vert s)} \nabla_\theta \pi(A\vert S;\theta) q_\pi(S,A) \right]\]

<p>重要性采样保证了我们在将策略梯度方法变为 off-policy 后，策略梯度的期望估计依然保持不变。因此，我们可以不用和环境紧密绑定在一次，每次更新都要重新采样。前面我们也提过，有时候相比梯度上升计算，与环境进行采样交互反而耗时更长。通过重要性采样，我们完全可以使用行为策略（$\theta^\prime=\theta_{\text{frozen}}$）与环境进行大批次采样后，得到样本更新目标策略，经过若干次迭代再进行硬拷贝。如下图所示：</p>

<p><a href="/assets/img/postsimg/20231127/ppo.jpg" class="popup img-link "><img data-src="/assets/img/postsimg/20231127/ppo.jpg" alt="PPO" class="lazyload" data-proofer-ignore></a></p>

<p>进一步，根据优势函数的定义，我们将重要性采样嵌入，则 A2C 的梯度上升式可改写为</p>

\[\begin{aligned}
\theta_{t+1} &amp;= \theta_t + \alpha \textcolor{red}{\frac{\pi(a_t\vert s_t;\theta)}{\beta(a_t\vert s_t)}} \nabla_{\theta_t} \ln\pi(a_t\vert s_t;\theta_t)\delta_t(a_t,s_t)\\
&amp;= \theta_t + \alpha \left(\frac{\delta_t(a_t,s_t)}{\beta(a_t\vert s_t)}\right) \nabla_\theta \pi(a_t\vert s_t;\theta_t)
\end{aligned}\]

<p>此时，对于 off-policy 方法，策略梯度方法中的行为策略 $\beta$ 不再发生变化，整个式子只剩下充分利用行为策略产生的样本（当 $\delta_t$ 比较大时增加对应的采样概率）。</p>

<p>相应的，价值网络的更新形式为</p>

\[\begin{aligned}
\delta_t &amp;= R_{t+1}+\gamma v(s_{t+1};\omega_t)-v(s_t;\omega_t)\\
J(\omega) &amp;= \frac{1}{2} \delta_t^2\\
\omega_{t+1} &amp;= \omega_t - \alpha_{\omega} \textcolor{red}{\frac{\pi(a_t\vert s_t;\theta)}{\beta(a_t\vert s_t)}} \delta_t \nabla_{\omega}v(s_t;\omega_t)
\end{aligned}\]

<h2 id="5-确定性策略梯度dpg"><span class="me-2">5. 确定性策略梯度（DPG）</span><a href="#5-确定性策略梯度dpg" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>前面介绍的所有策略梯度都是随机策略，即要求 $\pi(a\vert s;\theta) &gt; 0,\; \forall(s,a)$，缺点在于其对动作 $a$ 的个数是有限的（回顾如下网络结构）</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>          +----+ ----&gt; Q(s,a1)
  s  ---&gt; |f(x)| ----&gt; Q(s,a2)
          |  θ | ----&gt; ...
          +----+ ----&gt; Q(s,a3)
</pre></td></tr></tbody></table></code></div></div>

<p>当然，我们也可以使用确定性策略，这样做的好处是可以适应连续无限的动作空间。</p>

<p>对于随机性策略和确定性策略两种情况，策略定义为 $\pi(a\vert s;\theta)\in[0,1]$，那么对于确定性策略，即给定一个状态输出一个确定的动作，其可定义为</p>

\[a=\mu(s;\theta)\doteq \mu_\theta(s)\]

<p>此时策略网络直接把状态映射到动作：$\mu:S\to A$，即</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>          +----+
  s  ---&gt; |μ(x)| ----&gt; a
          |  θ | 
          +----+ 
</pre></td></tr></tbody></table></code></div></div>

<p>由于策略发生了变化，原来推导得到的策略梯度只适用于随机性策略，不再适用于确定性策略，需要重新推导。同样考虑基于初始状态价值的策略梯度，此时目标函数为</p>

\[J(\theta) = V_{\mu}(s)\]

<p>则相应的策略梯度为（推导略）</p>

\[\nabla_\theta J(\theta) = \mathbb{E}_{S\sim \rho_\beta}[\nabla_\theta \mu(S)\left(\nabla_a q_\mu(S,a)\right)_{\vert a=\mu(S)}]\]

<p>注意到其中并没有包含动作的分布 $A$，也就是说，确定性策略梯度是一个 off-policy 算法。并不要求我们必须按照哪个采样某个动作，因此可以使用任意行为策略 $\beta$ 进行采样。</p>

<blockquote>
  <p>DPG 的缺点很明显，对于每个状态，下一步的动作是确定的。这就导致只能做利用而不能做探索。这可能也是为什么要做 off-policy 的原因。我们可以设置行为策略为一个随机策略，采样后优化确定性的目标策略。</p>

  <p>更进一步，行为策略往往被设置为 $\beta = \mu + N$ 的形式，其中 $N$ 为随机噪声。此时就可以避免周期性的硬拷贝，随着确定性目标策略 $\mu$ 得到优化，行为策略也随之得到优化。</p>
</blockquote>

<p>当价值函数用线性函数近似时，即为 DPG 论文给出的原始方法。当使用深度神经网络时，该方法就变为 DDPG。</p>

<p>对于 DDPG 方法，其价值网络的更新部分不变</p>

\[\omega_{t+1} = \omega_t - \alpha_{\omega} \delta_t \nabla_{\omega}q(s_t,a_t;\omega_t)\]

<p>而策略网络的参数更新式为</p>

\[\theta_{t+1} = \theta_t + \alpha_\theta \nabla_\theta \mu(s;\theta)\left( \nabla_a q(s_t, a; w_{t+1}) \right)_{\vert a=\mu(s_t)}\]

<h2 id="6-参考文献"><span class="me-2">6. 参考文献</span><a href="#6-参考文献" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>[1] 静静的喝酒. <a href="https://blog.csdn.net/qq_34758157/article/details/125886399">CSDN 策略梯度方法介绍——Value-Based强化学习方法 VS Policy-Based强化学习方法</a></p>

<p>[2] 静静的喝酒. <a href="https://blog.csdn.net/qq_34758157/article/details/125929926">CSDN 策略梯度方法介绍——策略梯度定理推导过程</a></p>

<p>[3] 静静的喝酒. <a href="https://blog.csdn.net/qq_34758157/article/details/125945391">策略梯度方法介绍——蒙特卡洛策略梯度方法(REINFORCE)</a></p>

<p>[4] Richard S. Sutton and Andrew G. Barto. <a href="http://incompleteideas.net/book/the-book.html">Reinforcement Learning: An Introduction</a></p>

</div>

<div class="post-tail-wrapper text-muted">

  <!-- categories -->
  
  <div class="post-meta mb-3">
    <i class="far fa-folder-open fa-fw me-1"></i>
    
      <a href='/categories/academic/'>Academic</a>,
      <a href='/categories/knowledge/'>Knowledge</a>
  </div>
  

  <!-- tags -->
  
  <div class="post-tags">
    <i class="fa fa-tags fa-fw me-1"></i>
      
      <a href="/tags/reinforcement-learning/"
          class="post-tag no-text-decoration" >reinforcement learning</a>
      
  </div>
  

  <div class="post-tail-bottom
    d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
    <div class="license-wrapper">

      

        

        本文由作者按照 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         进行授权

      
    </div>

    <!-- Post sharing snippet -->

<div class="share-wrapper">
  <span class="share-label text-muted me-1">分享</span>
  <span class="share-icons">
    
    
    

    
      
      <a
        href="https://twitter.com/intent/tweet?text=%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%EF%BC%88%E7%AD%96%E7%95%A5%E6%A2%AF%E5%BA%A6%E6%B3%95%EF%BC%89%20-%20SIRLIS&url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Freinforcement-learning-Policy-Gradient%2F"
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Twitter"
        target="_blank"
        rel="noopener"
        aria-label="Twitter"
      >
        <i class="fa-fw fab fa-twitter"></i>
      </a>
    
      
      <a
        href="https://www.facebook.com/sharer/sharer.php?title=%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%EF%BC%88%E7%AD%96%E7%95%A5%E6%A2%AF%E5%BA%A6%E6%B3%95%EF%BC%89%20-%20SIRLIS&u=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Freinforcement-learning-Policy-Gradient%2F"
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Facebook"
        target="_blank"
        rel="noopener"
        aria-label="Facebook"
      >
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    
      
      <a
        href="https://t.me/share/url?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Freinforcement-learning-Policy-Gradient%2F&text=%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%EF%BC%88%E7%AD%96%E7%95%A5%E6%A2%AF%E5%BA%A6%E6%B3%95%EF%BC%89%20-%20SIRLIS"
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Telegram"
        target="_blank"
        rel="noopener"
        aria-label="Telegram"
      >
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <i
      id="copy-link"
      class="fa-fw fas fa-link small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="分享链接"
      data-title-succeed="链接已复制！"
    >
    </i>
  </span>
</div>


  </div><!-- .post-tail-bottom -->

</div><!-- div.post-tail-wrapper -->


      
    
      
    </div>
  </div>
  <!-- #core-wrapper -->

  <!-- panel -->
  <div id="panel-wrapper" class="col-xl-3 ps-2 text-muted">
    <div class="access">
      <!-- Get the last 5 posts from lastmod list. -->














  <div id="access-lastmod" class="post">
    <div class="panel-heading">最近更新</div>
    <ul class="post-content list-unstyled ps-0 pb-1 ms-1 mt-2">
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/artificial-intelligence-introduction/">人工智能（绪论）</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/artificial-intelligence-knowledge-etc/">人工智能（知识表示与推理）</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/astronomy-basic-coordinate/">天文学基础（坐标系统）</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/Pattern-Recognition-Nonlinear-Classifier/">模式识别（非线性分类器）</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/Pattern-Recognition-Feature-Selection-and-Extraction/">模式识别（特征选择与特征提取）</a>
        </li>
      
    </ul>
  </div>
  <!-- #access-lastmod -->


      <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">热门标签</div>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/deep-learning/">deep learning</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/python/">python</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/fuzzy/">fuzzy</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/pattern-recognition/">pattern recognition</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/vscode/">vscode</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/reinforcement-learning/">reinforcement learning</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/other/">other</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/astronomy/">astronomy</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/c-c/">c/c++</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/computer-vision/">computer vision</a>
      
    </div>
  </div>


    </div>

    
      
      



  <div id="toc-wrapper" class="ps-0 pe-4 mb-5">
    <div class="panel-heading ps-3 pt-2 mb-2">文章内容</div>
    <nav id="toc"></nav>
  </div>


    
  </div>
</div>

<!-- tail -->

  <div class="row">
    <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-3 pe-xl-4 mt-5">
      
        
        <!--
  Recommend the other 3 posts according to the tags and categories of the current post,
  if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->








  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  






<!-- Fill with the other newlest posts -->





  <div id="related-posts" class="mb-2 mb-sm-4">
    <h3 class="pt-2 mb-4 ms-1" data-toc-skip>
      相关文章
    </h3>
    <div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        
        
        <div class="col">
          <a href="/posts/reinforcement-learning-markov-process/" class="card post-preview h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em
  class="small"
  data-ts="1667968579"
  data-df="YYYY/MM/DD"
  
>
  2022/11/09
</em>

              <h4 class="pt-0 my-2" data-toc-skip>强化学习（马尔可夫决策过程）</h4>
              <div class="text-muted small">
                <p>
                  





                  本文介绍了强化学习的基本概念和模型，主要包括马尔可夫过程、马尔可夫奖励过程和马尔可夫决策过程。






  1. 强化学习
    
      1.1. 状态空间
        
          1.1.1. 状态
          1.1.2. 观测
        
      
      1.2. 动作空间
      1.3. 策略
    
  
  2. 马尔可夫...
                </p>
              </div>
            </div>
          </a>
        </div>
      
        
        
        <div class="col">
          <a href="/posts/reinforcement-learning-Dynamic-Programming/" class="card post-preview h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em
  class="small"
  data-ts="1669433059"
  data-df="YYYY/MM/DD"
  
>
  2022/11/26
</em>

              <h4 class="pt-0 my-2" data-toc-skip>强化学习（动态规划）</h4>
              <div class="text-muted small">
                <p>
                  





                  本文介绍了强化学习的动态规划法（Dynamic Programming，DP），采用动态规划的思想，分别介绍策略迭代和价值迭代方法。






  1. 强化学习问题的求解
  2. 动态规划
    
      2.1. 策略迭代
        
          2.1.1. 策略评估
          2.1.2. 策略改进
          2.1.3. 算法流程
   ...
                </p>
              </div>
            </div>
          </a>
        </div>
      
        
        
        <div class="col">
          <a href="/posts/reinforcement-learning-Monte-Carlo/" class="card post-preview h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em
  class="small"
  data-ts="1669712839"
  data-df="YYYY/MM/DD"
  
>
  2022/11/29
</em>

              <h4 class="pt-0 my-2" data-toc-skip>强化学习（蒙特卡洛法）</h4>
              <div class="text-muted small">
                <p>
                  





                  本文介绍了强化学习的 model-free 方法——蒙特卡洛法。






  1. 引言
  2. 蒙特卡洛法
    
      2.1. 大数定律与蒙特卡洛思想
      2.2. 蒙特卡洛基础算法
        
          2.2.1. 蒙特卡洛采样
          2.2.2. 蒙特卡洛价值估计
          2.2.3. 算法流程
        
 ...
                </p>
              </div>
            </div>
          </a>
        </div>
      
    </div>
    <!-- .card-deck -->
  </div>
  <!-- #related-posts -->


      
        
        <!-- Navigation buttons at the bottom of the post. -->

<div class="post-navigation d-flex justify-content-between">
  
    <a
      href="/posts/linux-reduce-repo-size-through-git-folder/"
      class="btn btn-outline-primary"
      prompt="上一篇"
    >
      <p>如何清理 .git 文件夹来减小 github 仓库大小</p>
    </a>
  

  
    <a
      href="/posts/Pattern-Recognition-Linear-Classifier/"
      class="btn btn-outline-primary"
      prompt="下一篇"
    >
      <p>模式识别（线性分类器）</p>
    </a>
  
</div>

      
        
        <!--  The comments switcher -->

  
  <!-- https://utteranc.es/ -->
<script src="https://utteranc.es/client.js"
        repo="sirlis/sirlis.github.io"
        issue-term="pathname"
        crossorigin="anonymous"
        async>
</script>

<script type="text/javascript">
  $(function() {
    const origin = "https://utteranc.es";
    const iframe = "iframe.utterances-frame";
    const lightTheme = "github-light";
    const darkTheme = "github-dark";
    let initTheme = lightTheme;

    if ($("html[data-mode=dark]").length > 0
        || ($("html[data-mode]").length == 0
            && window.matchMedia("(prefers-color-scheme: dark)").matches)) {
      initTheme = darkTheme;
    }

    addEventListener("message", (event) => {
      let theme;

      /* credit to <https://github.com/utterance/utterances/issues/170#issuecomment-594036347> */
      if (event.origin === origin) {
        /* page initial */
        theme = initTheme;

      } else if (event.source === window && event.data &&
            event.data.direction === ModeToggle.ID) {
        /* global theme mode changed */
        const mode = event.data.message;
        theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme);

      } else {
        return;
      }

      const message = {
        type: "set-theme",
        theme: theme
      };

      const utterances = document.querySelector(iframe).contentWindow;
      utterances.postMessage(message, origin);
    });

  });
</script>



      
    </div>
  </div>


        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-11 post-content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">热门标签</div>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/deep-learning/">deep learning</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/python/">python</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/fuzzy/">fuzzy</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/pattern-recognition/">pattern recognition</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/vscode/">vscode</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/reinforcement-learning/">reinforcement learning</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/other/">other</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/astronomy/">astronomy</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/c-c/">c/c++</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/computer-vision/">computer vision</a>
      
    </div>
  </div>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>
    </div>

    <!-- The Footer -->

<footer>
  <div class="container px-lg-4">
    <div class="d-flex justify-content-center align-items-center text-muted mx-md-3">
      <p>本站采用 <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> 主题 <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>
      </p>

      <p>©
        2025
        <a href="https://github.com/sirlis">sirlis</a>.
        
          <span
            data-bs-toggle="tooltip"
            data-bs-placement="top"
            title="除非另有说明，本网站上的博客文章均由作者按照知识共享署名 4.0 国际 (CC BY 4.0) 许可协议进行授权。"
          >保留部分权利。</span>
        
      </p>
    </div>
  </div>
</footer>


    <div id="mask"></div>

    <button id="back-to-top" aria-label="back-to-top" class="btn btn-lg btn-box-shadow">
      <i class="fas fa-angle-up"></i>
    </button>

    
      <div
        id="notification"
        class="toast"
        role="alert"
        aria-live="assertive"
        aria-atomic="true"
        data-bs-animation="true"
        data-bs-autohide="false"
      >
        <div class="toast-header">
          <button
            type="button"
            class="btn-close ms-auto"
            data-bs-dismiss="toast"
            aria-label="Close"
          ></button>
        </div>
        <div class="toast-body text-center pt-0">
          <p class="px-2 mb-3">发现新版本的内容。</p>
          <button type="button" class="btn btn-primary" aria-label="Update">
            更新
          </button>
        </div>
      </div>
    

    <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.0/dist/jquery.min.js,npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.7/dayjs.min.js,npm/dayjs@1.11.7/locale/zh.min.js,npm/dayjs@1.11.7/plugin/relativeTime.min.js,npm/dayjs@1.11.7/plugin/localizedFormat.min.js,npm/tocbot@4.21.0/dist/tocbot.min.js"></script>






<script defer src="/assets/js/dist/post.min.js"></script>


  <!-- MathJax -->
  <script>
    /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */
    MathJax = {
      tex: {
        /* start/end delimiter pairs for in-line math */
        inlineMath: [
          ['$', '$'],
          ['\\(', '\\)']
        ],
        /* start/end delimiter pairs for display math */
        displayMath: [
          ['$$', '$$'],
          ['\\[', '\\]']
        ]
      }
    };
  </script>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-chtml.js"></script>





    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  /* Note: dependent library will be loaded in `js-selector.html` */
  SimpleJekyllSearch({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('search-results'),
    json: '/assets/js/data/search.json',
    searchResultTemplate: '<div class="px-1 px-sm-2 px-lg-4 px-xl-0">  <a href="{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
    noResultsText: '<p class="mt-5"></p>',
    templateMiddleware: function(prop, value, template) {
      if (prop === 'categories') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
        }
      }

      if (prop === 'tags') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
        }
      }
    }
  });
</script>

  </body>
</html>

